<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="QNA">
	<select id="getList" resultType="hashmap" parameterType="hashmap">
		SELECT
			ID,
			subject,
			Content,
			writtenDate,
			viewcount,
			regid,
			regdate,
			updateId,
			UpdateDate,
			DATE_FORMAT(RegDate, '%Y-%m-%d') RegDateTime			
		FROM qna
		ORDER BY regdate desc
		LIMIT ${limit}
	</select>
	
	<select id="getCount" resultType="string">
		SELECT COUNT(*) from qna
	</select>
	
	<select id="getContent" resultType="hashmap" parameterType="hashmap">
		SELECT
			ID,
			subject,
			Content,
			writtenDate,
			viewcount,
			regid,
			regdate,
			updateId,
			UpdateDate,
			DATE_FORMAT(RegDate, '%Y-%m-%d') RegDateTime	
				
		FROM qna
		WHERE id = '${id}'
	</select>
	
	<update id="create" parameterType="hashmap">
		INSERT INTO
		qna (
			subject,
			Content,
			writtenDate,
			viewcount,
			regid
			)
		VALUES
		(
			'${subject}',
			'${Content}',
			DATE_FORMAT(NOW(),'%Y-%m-%d'),
			0 ,
			'${userid}'
		)
	</update>
	
	
	<select id="getReviewList" resultType="hashmap" parameterType="hashmap">
		SELECT
			ID,
			qna_id,
			content,
			writtenDate,
			regid,
			regdate,
			updateId,
			UpdateDate	
		FROM qnareview
		WHERE qna_id = '${qnaid}'
	</select>
	<select id="getReviewCount"   resultType="string">
		SELECT
			COUNT(*)
		FROM qnareview
		WHERE qna_id = '${qnaid}'
		LIMIT ${limit}
	</select>
	
	
	<update id="createReview" parameterType="hashmap">
		INSERT INTO
		qnaReview(
			qna_id,
			Content,
			writtenDate,
			regid
			)
		VALUES
		(
			'${qnaid}',
			'${content}',
			DATE_FORMAT(NOW(),'%Y-%m-%d'),
			'${userid}'
		)
	</update>
	
	<delete id="deleteReview">
		DELETE from qnaReview
		WHERE id = '${id}'
		AND regid = '${userid}'
	</delete>

</mapper>